---
title: "A Crash Course in Reproducible Computing"
format:
  html:
    toc: true
    toc-location: right
execute:
  echo: false
  fig-width: 6
  fig-asp: 0.6
  out-width: "90%"
---

In this, we will cover basic topics in reproducible computing, including coding style, project organization, and git/GitHub.

## Overview
::: {.panel-tabset .panel-pills}

### Slide Deck: project organization

[![](./slides/topic_reproducible_computing/preview.png){width=70%}](./slides/topic_reproducible_computing/reproducible_computing.pdf)

**Crash course on reproducible computing in R**  
[Download slides (PDF)](./slides/topic_reproducible_computing/reproducible_computing.pdf)


***

### Slide Deck: git/Github

[![](./slides/topic_reproducible_computing/preview2.png){width=70%}](./slides/topic_reproducible_computing/reproducible_computingII.pdf)

**Crash course on reproducible computing in R**  
[Download slides (PDF)](./slides/topic_reproducible_computing/reproducible_computingII.pdf)


***
### Lab: projectr


I asked ChatGPT to write me some code for creating a reproducible file structure for a new project. The prompt I used is below:


> Can you write me an R function that will take in a filepath, and name for a new directlry then create a new directory with that same that includes subfolders called "analysis", "source", "data", "results", and "literature", and also contains an initialized .git repo, a .Rproj file with the same name as the new directory in the root, and a README.md file?




Below is the code it wrote me. What is it doing?  Modify it to suit your own preferences, and see if it works!

- Also, we just spent a while talking about coding practices. What do you like about this code?  What do you dislike?

```{r, eval = FALSE, echo = TRUE}
create_r_project_skeleton <- function(base_path,
                                      project_name,
                                      open_rproj = FALSE,
                                      git = TRUE) {
  stopifnot(is.character(base_path), length(base_path) == 1, nzchar(base_path))
  stopifnot(is.character(project_name), length(project_name) == 1, nzchar(project_name))

  # Normalize inputs
  base_path <- normalizePath(base_path, winslash = "/", mustWork = FALSE)

  # Basic name safety (avoid characters that are awkward on Windows/macOS/Linux)
  if (grepl("[/\\\\:*?\"<>|]", project_name)) {
    stop("project_name contains invalid path characters. Use a simple folder name.")
  }

  project_path <- file.path(base_path, project_name)

  if (dir.exists(project_path)) {
    stop("Target project directory already exists: ", project_path)
  }

  # Create main directory
  ok <- dir.create(project_path, recursive = TRUE, showWarnings = FALSE)
  if (!ok || !dir.exists(project_path)) {
    stop("Failed to create project directory: ", project_path)
  }

  # Create subdirectories
  subdirs <- c("analysis", "source", "data", "results", "literature")
  for (d in subdirs) {
    dir.create(file.path(project_path, d), showWarnings = FALSE)
  }

  # Create .Rproj file
  rproj_path <- file.path(project_path, paste0(project_name, ".Rproj"))
  rproj_contents <- c(
    "Version: 1.0",
    "",
    "RestoreWorkspace: No",
    "SaveWorkspace: No",
    "AlwaysSaveHistory: Default",
    "",
    "EnableCodeIndexing: Yes",
    "UseSpacesForTab: Yes",
    "NumSpacesForTab: 2",
    "Encoding: UTF-8",
    "",
    "RnwWeave: Sweave",
    "LaTeX: pdfLaTeX"
  )
  writeLines(rproj_contents, con = rproj_path, useBytes = TRUE)

  # Create README.md
  readme_path <- file.path(project_path, "README.md")
  readme_contents <- c(
    paste0("# ", project_name),
    "",
    "## Overview",
    "Describe the purpose of this project.",
    "",
    "## Structure",
    "- `analysis/` - analysis scripts and notebooks",
    "- `source/` - reusable functions and modules",
    "- `data/` - raw and intermediate data (consider a data management policy)",
    "- `results/` - figures, tables, and outputs",
    "- `literature/` - papers, notes, and references",
    "",
    "## Reproducibility",
    "- Record package versions (e.g., `renv::init()`) as needed."
  )
  writeLines(readme_contents, con = readme_path, useBytes = TRUE)

  # Initialize git repo (optional)
  if (isTRUE(git)) {
    git_available <- nzchar(Sys.which("git"))
    if (!git_available) {
      warning("git=TRUE but Git executable not found on PATH; skipping git init.")
    } else {
      old_wd <- getwd()
      on.exit(setwd(old_wd), add = TRUE)
      setwd(project_path)

      # Initialize repository
      system2("git", c("init"), stdout = TRUE, stderr = TRUE)

      # Optional: create a minimal .gitignore tailored to typical R projects
      gitignore_path <- file.path(project_path, ".gitignore")
      gitignore_contents <- c(
        ".Rhistory",
        ".RData",
        ".Ruserdata",
        ".DS_Store",
        "Thumbs.db",
        "results/",
        "data/"
      )
      writeLines(gitignore_contents, con = gitignore_path, useBytes = TRUE)
    }
  }

  # Optionally open the project in RStudio if available
  if (isTRUE(open_rproj)) {
    if (interactive() && nzchar(Sys.which("rstudio"))) {
      system2("rstudio", rproj_path, wait = FALSE)
    } else if (interactive()) {
      message("open_rproj=TRUE but could not find 'rstudio' on PATH; created: ", rproj_path)
    }
  }

  invisible(list(
    project_path = project_path,
    subdirs = file.path(project_path, subdirs),
    rproj = rproj_path,
    readme = readme_path,
    git_initialized = isTRUE(git) && nzchar(Sys.which("git"))
  ))
}

```




### Lab: CDC open data

The CDC has over 1300 open-source datasets available at [data.cdc.gov](https://data.cdc.gov/).

- Topic areas include injury & violence, vaccination, smoking,pregnancy, chronic disease, and disease surveillance
- Great source of Covid surveillance data
- [data.gov](https://data.gov/) hosts additional 250K+ datasets

The [**Covid Wastewater dataset**](https://www.cdc.gov/nwss/rv/COVID19-national-data.html#about-data) comes from the National Wastewater Surveillance System(NWSS) Public SARS-CoV-2 Concentration in Wastewater Data.

- Contains SARS-CoV-2 concentration at different sampling locations across the U.S.
- Update Daily

There are two available datasets:
  
1. Longitudinal data, which has four columns and provides concentrations over time
2. Cross-sectional data, which includes current concentration and other summaries, as well as information about state, county (16 total columns)

Our goal is to produce an end-to-end reproducible workflow with this data. We will do the following:

1. Download the data directly into R by interacting with the CDC API.
2. Clean the data: Longitudinal data contains concentrations over time,and cross-sectional data contains information about county each data collection site is located in. We will merge these two datasets and subset to collection sites in Georgia only.
3. Analyze data.
4. Visualize data.

Pull these steps together into a documented reproducible report.


#### 1: Create final report


I've done most of these steps for us already by creating an example project folder. Download it [here](labs/example_project.zip).

- Download and unzip this folder
- Check out the files in the `source` subfolder. What are each of these doing?
- Build a `final_report` Quarto or R Markdown document that calls each of the steps of the data analysis, and explains what is being done at each step.
- As you make changes to the project, commit changes using `git`.
- Feel free to add some of your own visualizations.

#### 2: Upload to GitHub

- Push your finished project to GitHub
- Clone one of your classmate's repos and try to run their final report document. Was it fully reproducible?



***
:::
